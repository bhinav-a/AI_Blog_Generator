{% extends 'scraper/base.html' %}

{% block title %}Job // {{ scraped_data.id }}{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
    <div>
        <h2 class="display-6 fw-bold mb-1">> Job Report</h2>
        <p class="text-muted-dark mb-0">Task ID [{{ scraped_data.id }}] executed {{ scraped_data.created_at }}.</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'scraper:index' %}" class="btn btn-outline-light">
            <i class="bi bi-arrow-left-circle me-1"></i>Return
        </a>
        {% if scraped_data.status == 'success' %}
            <a href="{% url 'scraper:download' scraped_data.pk %}" class="btn btn-primary fw-bold">
                <i class="bi bi-download me-1"></i>Download Payload
            </a>
        {% endif %}
    </div>
</div>

<hr style="border-color: var(--border-glow);">

<div class="mt-4">
    <dl class="row">
        <dt class="col-sm-3 text-muted-dark">URL:</dt>
        <dd class="col-sm-9"><a href="{{ scraped_data.url }}" target="_blank">{{ scraped_data.url }}</a></dd>

        <dt class="col-sm-3 text-muted-dark">Title:</dt>
        <dd class="col-sm-9">{{ scraped_data.title|default:"// no title //" }}</dd>

        <dt class="col-sm-3 text-muted-dark">Status:</dt>
        <dd class="col-sm-9">
            <span class="status-badge status-{{ scraped_data.status|lower }}">
                {{ scraped_data.get_status_display }}
            </span>
        </dd>

        <dt class="col-sm-3 text-muted-dark">Timestamp:</dt>
        <dd class="col-sm-9">{{ scraped_data.created_at|date:"Y-m-d H:i:s T" }}</dd>

        {% if scraped_data.error_message %}
            <dt class="col-sm-3 text-muted-dark" style="color: #ff4b4b;">Error:</dt>
            <dd class="col-sm-9" style="color: #ff4b4b;">
                {{ scraped_data.error_message }}
            </dd>
        {% endif %}
    </dl>
</div>

{% if json_content %}
    <hr class="my-5" style="border-color: var(--border-glow);">
    
    <div class="mt-4">
        <h4 class="fw-bold mb-3">> JSON_Payload</h4>
        <div class="json-content">
            <pre>{{ json_content|pprint }}</pre>
        </div>
    </div>
{% endif %}
{% endblock %}